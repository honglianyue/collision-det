% ==========================================================================
% 六轴机器人 Modified DH 参数建模脚本
% 功能：
%   - 输入 DH 参数
%   - 构造每个关节坐标系的变换矩阵
%   - 输出各坐标系的位置和变换矩阵
%   - 支持任意角度输入（可修改为自动输入或固定值）
% 日期：2025年4月5日
% ==========================================================================

clear; clc; close all;

%% 1. 定义 DH 参数（改进 Denavit-Hartenberg）

a = [0, 0, 294.279, -50, 0, 0];          % 连杆长度 a_i
d = [313, 0, 0, 290, -136, 103.5];       % 偏移量 d_i
alpha = deg2rad([0, -90, 180, -90, 90, -90]);  % 扭角 alpha_i (deg -> rad)
offset = deg2rad([0, -80.2175, -80.2175, 0, 0, 0]);  % 关节偏置

n = length(a);  % 六轴机器人

%% 2. 输入关节角（可以改为手动输入或预设值）

theta_deg = [0, 0, 0, 0, 0, 0];  % 示例角度（单位：度）
theta_rad = deg2rad(theta_deg);  % 转换为弧度

%% 3. 构造每个关节的变换矩阵（使用 Modified DH）

T = cell(1, n);  % 存储 {i} 到 {i+1} 的变换矩阵
T0i = cell(1, n);  % 存储 {i} 相对于 {0} 的变换矩阵

T0 = eye(4);  % 基坐标系 {0}

for i = 1:n
    % 加上偏置角度
    theta_i = theta_rad(i) + offset(i);
    
    % 构造第 i 个变换矩阵
    T{i} = modified_dh_matrix(a(i), alpha(i), d(i), theta_i);
    
    % 累积变换
    T0i{i} = T0 * T{i};
    T0 = T0i{i};  % 更新当前坐标系
end

%% 4. 输出结果

disp('==================== 各坐标系相对于前一个的变换矩阵 ====================');
for i = 1:n
    fprintf('变换矩阵 T_%d%d:\n', i-1, i);
    disp(T{i});
end

disp('======================= 各坐标系在基坐标下的位置 =======================');
for i = 1:n
    origin = T0i{i}(1:3, 4);  % 提取平移向量（原点位置）
    fprintf('坐标系 {%d} 的原点位置: x=%.3f, y=%.3f, z=%.3f\n', i, origin(1), origin(2), origin(3));
end

disp('========================= 末端执行器位姿（相对于{0}）=========================');
T06 = T0i{n};
disp(T06);
%% 函数定义
% 定义所有坐标系相对于基座标的变换矩阵
T011 = eye(4);  % 坐标系1与基重合

T022 = [1, 0, 0, 0;
       0, 1, 0, 0;
       0, 0, 1, 313;
       0, 0, 0, 1];

T033 = [-1, 0, 0, 50;
       0, -1, 0, 0;
       0, 0, 1, 603;
       0, 0, 0, 1];

T044 = [-1, 0, 0, 0;
       0, -1, 0, 0;
       0, 0, 1, 893;
       0, 0, 0, 1];

T055 = [-1, 0, 0, 0;
       0, -1, 0, -136;
       0, 0, 1, 893;
       0, 0, 0, 1];

T066 = [-1, 0, 0, 0;
       0, -1, 0, -136;
       0, 0, 1, 996.5;
       0, 0, 0, 1];
%保存为一个cell数组
T0ii = {T011, T022, T033, T044, T055, T066};
%% 函数定义区

function T = modified_dh_matrix(a, alpha, d, theta)
% 根据 Modified DH 参数构造 SE(3) 齐次变换矩阵
% 输入：
%   a     - 连杆长度
%   alpha - 扭角（弧度）
%   d     - 偏移量
%   theta - 关节角（弧度）

T = [cos(theta), -sin(theta), 0, a;
     sin(theta)*cos(alpha), cos(theta)*cos(alpha), -sin(alpha), -d*sin(alpha);
     sin(theta)*sin(alpha), cos(theta)*sin(alpha), cos(alpha), d*cos(alpha);
     0, 0, 0, 1];
end